<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="alanglang.naree.db.mapper.AndMapper">


	<select id="searchMaxEngSeq" resultType="String">
		SELECT max(eng_seq) as eng_seq FROM eng_tb
	</select>
	
	<select id="findTodayEng" resultType="Eng">
		SELECT eng_seq
					,eng_sentence
					,eng_mean
					,eng_sound_server
					,eng_image_server
		  FROM eng_tb
		  <![CDATA[
		WHERE date(now()) = date(today_date)
		  ]]>
	</select>
	
		<select id="findEngByEngSeq" parameterType="String" resultType="Eng">
		SELECT eng_seq
					,eng_sentence
					,eng_mean
					,eng_sound_server
					,eng_image_server
		  FROM eng_tb
		WHERE eng_seq = #{eng_seq}
	</select>
	
	<select id="findThreeEngByEngSeq" resultType="Eng">
		SELECT eng_seq
					,today_date
					,eng_sentence
					,eng_mean
		  FROM eng_tb
    ORDER BY eng_seq DESC
           LIMIT 1, 3
	</select>
	
		<select id="selectNineEng" resultType="Eng">
		SELECT eng_seq
					,today_date
					,eng_sentence
					,eng_mean
		  FROM eng_tb
		  <![CDATA[
		WHERE date(now()) >= date(today_date)
		  ]]>
    ORDER BY today_date DESC
           LIMIT 1,9
	</select>
	
	<select id="findAd" resultType="Ad">
		SELECT ad_seq
					,start_date
					,end_date
					,company_name
					,company_tel
					,company_addr1
					,ad_name
					,ad_sound_name
					,ad_image_name
      				,ad_sound_server
      				,ad_image_server
      				,ad_url
      				,youtube_addr
      			,ad_gubun
      				,input_date
      				,call_num
      				,entry_or
		  FROM ad_tb
		  <![CDATA[
		WHERE date(start_date) <= date(now())
			AND date(now()) <= date(end_date)
			]]>
   ORDER BY call_num asc
		  LIMIT 1
	</select>
	
	<update id="updateCallNum" parameterType="Ad">
		UPDATE ad_tb
		      SET call_num = #{call_num} 
	    WHERE ad_seq = #{ad_seq}
	</update>
	
	<select id="selectEntrySeq" resultType="String">
		SELECT max(entry_seq) as entry_seq FROM entries_tb
	</select>
	
	<insert id="insertEntries" parameterType="Entries">
		INSERT INTO entries_tb (
							entry_seq
							,name
							,email
							,phone
							,input_datetime
							,ad_seq ) VALUES (
							#{entry_seq}
							,#{name}
							,#{email}
							,#{phone}
							,now()
							,#{ad_seq} )
	</insert>
	
	<select id="selectEntries" parameterType="Entries" resultType="Integer">
		SELECT count(*) FROM entries_tb
		WHERE ad_seq = #{ad_seq}
		    AND name = #{name}
		    AND email = #{email}
		    AND 	phone = #{phone}
	</select>
	
	<select id="selectAdEntryResult" parameterType="Entries" resultType="SqlEntriesAd">
		SELECT e.name, e.email, e.phone, IFNULL(e.win_sepa, "당첨 결과 전입니다.") as win_sepa, IFNULL(e.coupon_num, "") as coupon_num, e.input_datetime, e.ad_seq
       		        ,a.ad_seq, a.start_date, a.end_date, a.ad_name
		   FROM entries_tb e, ad_tb a
         WHERE e.ad_seq = a.ad_seq
             AND e.name = #{name} 
             AND e.email = #{email}
             AND e.phone = #{phone}
    ORDER BY a.end_date DESC
	</select>
	
	<select id="selectTodayEng" resultType="Eng">
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date 
		  FROM eng_tb
		  <![CDATA[
		WHERE date(now()) >= date(today_date)
		  ]]>
	ORDER BY today_date DESC
			LIMIT 1
	</select>
	<select id="selectThreeEng" resultType="Eng">
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date 
		  FROM eng_tb
		  <![CDATA[
		WHERE date(now()) >= date(today_date)
		  ]]>
	ORDER BY today_date DESC
			LIMIT 1, 3
	</select>
	
	<select id="selectThreeEngReLeft" resultType="Eng" parameterType="String">
	  SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date 
		FROM eng_tb
		<![CDATA[
		WHERE date((SELECT today_date FROM eng_tb WHERE eng_seq = #{eng_seq})) >= date(today_date)
		]]>
	ORDER BY today_date DESC
			LIMIT 1, 3
	</select>
	<select id="selectThreeEngReRight" resultType="Eng" parameterType="String">
		SELECT * FROM (
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date 
		FROM eng_tb
		<![CDATA[
		WHERE date((SELECT today_date FROM eng_tb WHERE eng_seq = #{eng_seq})) <= date(today_date)
		]]>
	ORDER BY today_date ASC
			LIMIT 1, 3
	) e ORDER BY today_date DESC
	</select>
	<select id="selectThreeEngReRightMax" resultType="Eng">
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date 
		FROM eng_tb
	ORDER BY today_date DESC
			LIMIT 3
	</select>
	<select id="selectThreeEngReLeftMax" resultType="Eng">
		SELECT * FROM (
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date 
		FROM eng_tb
	ORDER BY today_date ASC
			LIMIT 3 
	) e ORDER BY today_date DESC
	</select>
	
	<select id="selectEngByEngSeq" parameterType="String" resultType="Eng">
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date
		  FROM eng_tb
		WHERE eng_seq = #{eng_seq}
	</select>
	
	<select id="selectNineEngByEng" parameterType="Eng" resultType="Eng">
		SELECT eng_seq, today_date, eng_sentence, eng_mean, eng_sound_name, eng_sound_server, input_date
		  FROM eng_tb
		  <![CDATA[
		 WHERE date(today_date) < date(#{today_date})
		  ]]>
    ORDER BY today_date DESC
           LIMIT 9
	</select>
	
	<select id="selectMaxMainBg" resultType="MainBg">
		SELECT main_bg_seq, main_bg_name, main_bg_server, input_date 
	      FROM main_bg_tb
		WHERE main_bg_seq = (SELECT max(main_bg_seq) FROM main_bg_tb)
	</select>
	<select id="selectMaxStarBg" resultType="StarBg">
		SELECT star_bg_seq, star_bg_name, star_bg_server, input_date 
	      FROM star_bg_tb
		WHERE star_bg_seq = (SELECT max(star_bg_seq) FROM star_bg_tb)
	</select>
	<select id="selectMaxEngBg" resultType="EngBg">
		SELECT eng_bg_seq, eng_bg_name, eng_bg_server, input_date 
	      FROM eng_bg_tb
		WHERE eng_bg_seq = (SELECT max(eng_bg_seq) FROM eng_bg_tb)
	</select>
	
	
	
</mapper>